<!-- https://www.kaggle.com/datasets/dataanalyst001/population-of-all-us-cities-2024 -->

<!DOCTYPE html>
<html lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="src/style.css">

    <script src='https://d3js.org/d3.v5.min.js'></script>
    <body onload='init()'>
      <div class="title-container">
          <h1 class="title">Population Of All popular US Cities</h1>
          <h2 class="subtitle">Explore demographic trends across different cities</h2>
      </div>
      <div class="flex-container">
        <div class="button-container">
            <button onclick="logRegion('Western States')">Western States</button>
            <div class="nested-buttons">
                <button onclick="logRegion('Pacific States')">Pacific States</button>
                <button onclick="logRegion('Mountain States')">Mountain States</button>
            </div>
        </div>
        <div class="button-container">
            <button onclick="logRegion('Midwestern States')">Midwestern States</button>
            <div class="nested-buttons">
                <button onclick="logRegion('East North Central')">East North Central</button>
                <button onclick="logRegion('West North Central')">West North Central</button>
            </div>
        </div>
        <div class="button-container">
            <button onclick="logRegion('Eastern States')">Eastern States</button>
            <div class="nested-buttons">
                <button onclick="logRegion('Northeast')">Northeast</button>
                <button onclick="logRegion('South')">South</button>
            </div>
        </div>
      </div>
      <div class="svg-container">
          <!-- SVG inside a div that controls the size -->
          <svg class="svg1" viewBox="0 0 960 500"></svg>
          <svg class="svg1_region"></svg>
      </div>

      <div class="svg-container2">
          <!-- SVG inside a div that controls the size -->
          <svg class="svg2" viewBox="0 0 960 500"></svg>
      </div>
    <script>
    async function init() {

      function logRegion(regionName) {
        console.log("Clicked on: " + regionName);
      }
      // const data = await d3.csv('https://raw.githubusercontent.com/pyangyu/NarrativeVisualization/main/data/PopulationOfAllUSCities2024.csv', function(d) {
      //     return {
      //         rank: +d.Rank,
      //         city: d.USCity,
      //         state: d.USState,
      //         population2024: +d.Population2024,
      //         population2020: +d.Population2020,
      //         annualChange: +d.AnnualChange,
      //         density: +d.Density,
      //         area: +d.Area
      //     };
      // });
      const data = await d3.csv('https://raw.githubusercontent.com/pyangyu/NarrativeVisualization/main/data/PopulationOfAllUSCities2024.csv');
          
      // const metrics = ['rank', 'population2024', 'population2020', 'annualChange', 'density', 'area'];
      // const stats = metrics.map(metric => ({
      //     name: metric,
      //     min: d3.min(data, d => d[metric]),
      //     max: d3.max(data, d => d[metric])
      // }));

      // d3.select("body").selectAll('h2')
      //    .data(stats)
      //    .enter()
      //    .append('h3')
      //    .text(d => `Metric: ${d.name}, Min: ${d.min}, Max: ${d.max}`);









      // region

      var svg_r = d3.select("svg.svg1_region"); 
      var data_region = [
          { region: "Africa | North & East", color: "#FFD700" },
          { region: "Africa | South & West", color: "#FF8C00" },
          { region: "America | North & Central", color: "#ADFF2F" },
          { region: "America | South", color: "#4B0082" },
          { region: "Asia | East & Central", color: "#F08080" },
          { region: "Asia | South & West", color: "#90EE90" },
          { region: "Europe | North & West", color: "#ADD8E6" },
          { region: "Europe | South & East", color: "#E0FFFF" },
          { region: "Oceania", color: "#20B2AA" },
      ];

      // Create Legend
      var legend = svg_r.append("g")
                      .attr("class", "legend")
                      .attr("transform", "translate(50, 50)");  // Adjust the position according to your SVG dimensions

      legend.selectAll("rect")
            .data(data_region)
            .enter().append("rect")
            .attr("x", 0)
            .attr("y", function(d, i) { return i * 24; })  // Space rectangles
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", function(d) { return d.color; });

      legend.selectAll("text")
            .data(data_region)
            .enter().append("text")
            .attr("x", 24)
            .attr("y", function(d, i) { return i * 24 + 14; })
            .text(function(d) { return d.region; });

      // Optionally add title to the legend
      legend.append("text")
            .attr("x", 0)
            .attr("y", -10)
            .attr("font-weight", "bold")
            .text("Region");



      var svg = d3.select("svg.svg1"); 

      var x = d3.scaleLog()
                .range([0, 860]) // Width of the SVG minus margins
                .domain([100000, 9000000]); // Log scale from 100,000 to 9,000,000

      var y = d3.scaleLog()
                .range([400, 0]) // Height of the SVG, inverted for y-axis
                .domain([100000, 9000000]); // Same for y, as populations are similarly ranged

      var gPoints = svg.append("g")
                       .attr("transform", "translate(50, 50)"); // Apply transformation for margin

      gPoints.selectAll(".circle")
        .data(data)
        .enter().append("circle")
        .attr("cx", function(d) { return x(d.Population2024); })
        .attr("cy", function(d) { return y(d.Population2020); })
        .attr("r", function(d) { return 5; })
        .transition().duration(3000).delay(1000)
        .attr("r", function(d) { return 10; });

        // Append and transform the y-axis group
        var gYAxes = svg.append("g")
                       .attr("transform", "translate(" + 50 + "," + 50 + ")") // Position y-axis group correctly
                       .call(d3.axisLeft(y)
                          .tickValues([100000, 1000000, 9000000]) // Specific ticks for clarity
                          .tickFormat(d3.format(".0s"))); // Format ticks with SI prefix, no decimal

        // Append and transform the x-axis group at the bottom
        var gXAxes = svg.append("g")
                       .attr("transform", "translate(" + 50 + "," + 450 + ")")
                       .call(d3.axisBottom(x)
                          .tickValues([100000, 1000000, 9000000]) // Matching tick values
                          .tickFormat(d3.format(".0s"))); // Same format as y-axis


















        var svg2 = d3.select("svg.svg2"); // Select the svg with class "svg2"

        var x2 = d3.scaleLog()
                  .range([0, 860]) // Width of the SVG minus margins
                  .domain([100000, 9000000]); // Log scale from 100,000 to 9,000,000

        var y2 = d3.scaleLog()
                  .range([400, 0]) // Height of the SVG, inverted for y-axis
                  .domain([100000, 9000000]); // Same for y, as populations are similarly ranged

        var gPoints2 = svg2.append("g")
                         .attr("transform", "translate(50, 50)"); // Apply transformation for margin

        gPoints2.selectAll(".circle")
            .data(data) // Make sure your data is defined or loaded before this script runs
            .enter().append("circle")
            .attr("cx", function(d) { return x(d.Population2024); })
            .attr("cy", function(d) { return y(d.Population2020); })
            .attr("r", function(d) { return 5; })
            .transition().duration(4000).delay(3000)
            .attr("r", function(d) { return 10; });

        // Append and transform the y-axis group
        var gYAxes2 = svg2.append("g")
                       .attr("transform", "translate(50, 50)") // Position y-axis group correctly
                       .call(d3.axisLeft(y2)
                          .tickValues([100000, 1000000, 9000000]) // Specific ticks for clarity
                          .tickFormat(d3.format(".0s"))); // Format ticks with SI prefix, no decimal

        // Append and transform the x-axis group at the bottom
        var gXAxes2 = svg2.append("g")
                       .attr("transform", "translate(50, 450)")
                       .call(d3.axisBottom(x2)
                          .tickValues([100000, 1000000, 9000000]) // Matching tick values
                          .tickFormat(d3.format(".0s"))); // Same format as y-axis

}
</script>
</body>
</html>